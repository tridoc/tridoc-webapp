!function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.r(t);var a=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t.startsWith("http")?this.url=t:this.url="https://"+t,this.headers=new Headers,n&&r&&this.headers.set("Authorization","Basic "+btoa(n+":"+r)),this.postHeaders=new Headers,this.postHeaders.set("Authorization",this.headers.get("Authorization")),this.postHeaders.set("Content-Type","application/json")}var t,n,a;return t=e,(n=[{key:"addTag",value:function(e,t,n,r){var a={label:t};return n&&(a.parameter={type:"http://www.w3.org/2001/XMLSchema#"+n,value:r}),fetch(this.url+"/doc/"+e+"/tag",{method:"POST",headers:this.postHeaders,body:JSON.stringify(a)}).then(function(e){return e.json()})}},{key:"countDocuments",value:function(e,t,n){return fetch(this.url+"/count?text="+encodeURIComponent(e)+t+n,{headers:this.headers}).then(function(e){return e.json()})}},{key:"createTag",value:function(e,t){var n={label:e};return t&&(n.parameter={type:"http://www.w3.org/2001/XMLSchema#"+t}),fetch(this.url+"/tag",{method:"POST",headers:this.postHeaders,body:JSON.stringify(n)}).then(function(e){return e.json()})}},{key:"deleteDocument",value:function(e){return fetch(this.url+"/doc/"+e,{method:"DELETE",headers:this.headers})}},{key:"deleteTag",value:function(e){return fetch(this.url+"/tag/"+encodeURIComponent(e),{method:"DELETE",headers:this.headers}).then(function(e){return e.json()})}},{key:"getDocuments",value:function(e,t,n,r,a){var o=this.url+"/doc?text="+e+t+n+"&limit="+r+"&offset="+a;return console.log(o),fetch(o,{headers:this.headers}).then(function(e){return e.json()})}},{key:"getTags",value:function(e){return e?fetch(this.url+"/doc/"+e+"/tag",{headers:this.headers}).then(function(e){return e.json()}):fetch(this.url+"/tag",{headers:this.headers}).then(function(e){return e.json()})}},{key:"removeTag",value:function(e,t){return fetch(this.url+"/doc/"+e+"/tag/"+t,{method:"DELETE",headers:this.headers})}},{key:"setDocumentTitle",value:function(e,t){var n={title:t};return fetch(this.url+"/doc/"+e+"/title",{method:"PUT",headers:this.postHeaders,body:JSON.stringify(n)})}},{key:"uploadFile",value:function(e){if("application/pdf"!=e.type)return Promise.reject("Please provide a pdf document");var t=new Headers;return t.set("Authorization",this.headers.get("Authorization")),t.set("Content-Type","application/pdf"),fetch(this.url+"/doc",{method:"POST",headers:t,body:e}).then(function(e){return e.status>=400?e.json():{success:!0,location:e.headers.get("Location")}}).then(function(e){if(e.error)throw"Server responded with "+e.statusCode+": "+e.error;return e})}}])&&r(t.prototype,n),a&&r(t,a),e}(),o=window["pdfjs-dist/build/pdf"];o.GlobalWorkerOptions.workerSrc="//mozilla.github.io/pdf.js/build/pdf.worker.js";var i=document.getElementById("server-url"),s=document.getElementById("server-username"),c=document.getElementById("server-password"),l=document.getElementById("server-save"),d=document.getElementById("search-documents"),u=document.createElement("div");u.classList.add("loader");var h=document.getElementById("document"),m=(document.getElementById("pdf-text"),document.createElement("div"));m.classList.add("loader");var p=localStorage;p.getItem("server")?i.value=p.getItem("server"):i.value="http://localhost:8000",p.getItem("username")&&(s.value=p.getItem("username")),p.getItem("password")&&(c.value=p.getItem("password"));var f=new a(i.value,s.value,c.value),g=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:h,o=a===h;t.getPage(n).then(function(i){console.log("Page ".concat(n," loaded"));var s=document.createElement("canvas");s.classList.add("pdf-canvas");var c=i.getViewport({scale:1});c.height=c.height||c.viewBox[3],c.width=c.width||c.viewBox[2];var l=a.offsetWidth,d=l/c.width,u=c.height*d,h=i.getViewport({scale:d}),p=s.getContext("2d");s.height=u,s.width=l;var f={canvasContext:p,viewport:h};i.render(f).promise.then(function(){m.parentNode&&o&&m.parentNode.removeChild(m),a.appendChild(s),console.log("Page ".concat(n," of ").concat(r>-1?r:t.numPages," rendered")),n<t.numPages&&(-1===r||n<r)?(o&&a.appendChild(m),e(t,n+1,r,a)):console.log("Finished rendering PDF")})})},v=function(e){h.innerHTML="",h.appendChild(m);var t=f.url+"/doc/"+e;console.log("Rendering ".concat(t)),o.getDocument({url:t,httpHeaders:{Authorization:f.headers.get("Authorization")}}).promise.then(function(e){console.log("PDF loaded"),g(e)},function(e){var t,n;m.parentNode&&m.parentNode.removeChild(m),h.appendChild((t=e,(n=document.createElement("div")).classList="error",n.textContent=t.status?"Error ".concat(t.status,": ").concat(t.message?t.message:t):t,n))})};function y(){document.querySelectorAll(".s__th").forEach(function(e){var t=e.closest(".s__id").getAttribute("data-document-id");if(t){var n=document.createElement("div");n.classList="loader loader-small inline",e.appendChild(n),f.getTags(t).then(function(t){var n="";t.error?e.innerHTML="Error: "+t.error:t.length>0?(t.sort(function(e,t){return e.label.localeCompare(t.label)}),t.forEach(function(e){var t,r="simple",a="mi-tag";e.parameter&&(t=e.parameter.value,"http://www.w3.org/2001/XMLSchema#decimal"==e.parameter.type?(r="decimal",a="mi-num"):"http://www.w3.org/2001/XMLSchema#date"==e.parameter.type&&(r="date",a="mi-cal"));var o=t?'<span class="tag-value">'+t+"</span>":"";n+="<div class='tag' data-tag-type='".concat(r,"' data-tag-label='").concat(e.label,"'>\n                        <i class='tag-icon ").concat(a,"'>").concat(r,'</i>\n                        <span class="tag-text">').concat(e.label,"</span>\n                        ").concat(o,"\n                        </div>")}),e.innerHTML=n):(n="<i>No Tags</i>",e.innerHTML=n)}).catch(function(t){e.innerHTML="Error: "+t})}})}function w(){console.log("Fillout");var e=this.getElementsByClassName("s__t")[0].innerHTML,t=this.getAttribute("data-document-id");document.getElementById("current-title").innerHTML=e===t?"<i>Untitled Document <code>".concat(t,"<code></i>"):e,document.getElementsByClassName("main")[0].setAttribute("data-document-id",t),y(),v(t)}var b=function e(t){var n=document.getElementById("document-list");function r(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:", ",a=e.exec(t);return a?n+a[1]+r(e,t,n):""}n.innerHTML="",n.appendChild(u);var a=" "+d.value,o=/[^!#\\\b]\B#([^\s"',;:]+?(?=\s|$))/g,i=/[^#\\]\B!#([^\s"',;:]+?(?=\s|$))/g,s=a?encodeURIComponent(a.replace(o,"").replace(i,"").replace(/^ /,"").replace(/\\/,"")):"",c=r(o,a,"&tag="),l=r(i,a,"&nottag="),h=c||"",m=l||"";isNaN(t)&&(t=0);var g=p.getItem("limit")>0?p.getItem("limit"):"",v=t*g;f.getDocuments(s,h,m,g,v).then(function(t){var r="";if(t.error)n.innerHTML=t.error;else if(t.length>0)t.forEach(function(e){var t=e.title?e.title:e.identifier,r=document.createElement("button");r.classList="list-item list-item-flexible fillout-button s__id",r.setAttribute("data-document-id",e.identifier);var a=document.createElement("h2");a.classList="s__t",a.innerHTML=t,r.appendChild(a);var o=document.createElement("div");o.classList="s__th",r.appendChild(o),r.addEventListener("click",w),u.parentNode.removeChild(u),n.appendChild(r),n.appendChild(u)}),u.parentNode.removeChild(u);else{r="<div class=''><div class='list-content'><h3 class='mdc-typography--headline5'><span class='material-icons'>blur_off</span>"+(s?" Nothing Found":" Documents will appear here")+"</h3><span class='mdc-typography--subtitle1'>"+(s?"You can try another query":"Upload something")+"</span></div></div>",n.innerHTML=r}document.querySelectorAll(".page-switch").forEach(function(t){return t.addEventListener("click",function(){e(t.getAttribute("data-pagination-target"))})}),y()}).catch(function(e){console.log(e)})};l.addEventListener("click",function(){var e=i.value;f=new a(e,s.value,c.value);try{p.setItem("server",e),p.setItem("username",s.value),p.setItem("password",c.value)}catch(e){console.log(e)}b()}),d.addEventListener("keydown",function(e){"Enter"===e.key&&b()}),b()}]);
//# sourceMappingURL=index.js.map